智能交通系统中行人检测算法的研究
摘  要
随着科技水平的不断发展，智能交通技术愈加完善，其应用场景及需求量不断扩大。相较于传统的智能交通系统，新一代智能交通系统无论在硬件基础上还是在软件算法上都日趋完善，已经具备实时性、及时性、高准确性、低误报率等优质性能。新一代智能交通系统通过对路况进行全天候、无间断监测，同时对实时获取的监测数据通过计算机技术进行高效计算处理，以此作为依据实现道路交通智能化。行人检测模块作为智能交通系统中重要的组成部分已经成为国内外学者研究的核心课题，在科研领域及工程应用方面均具有广泛的发展前景。
本文针对智能交通系统中的行人检测部分深入研究，通过对高清摄像机拍摄的行人图像进行实验分析。与当前流行的行人检测算法进行实验对比进而深入分析本文提出的改进算法。在行人检测领域中，检测算法方面的工作内容主要集中在以下三个方面：一，通过图像滤波、形态学处理等相关图像处理技术，对视频图像序列进行优化处理，在保留图像有效信息的基础上尽量较少冗余信息的干扰；二，特征集的选取，本文区别于传统特征集的选取，将单一的梯度方向直方图（Histogram of Oriented Gradient，HOG）特征与局部二值（Local Binary Patterns，LBP）特征利用统计直方图级联进行特征融合，以获取更深刻更全面的图像信息；三，在训练分类器的部分，改变传统的训练方式即利用线性支持向量机（Support Vector Machine，SVM）训练分类器，采用截取后的卷积神经网络（Convolutional Neural Network，CNN）作为分类器的训练算法，利用三层全连接层进行训练，最终获取性能较好的分类器。
至此，通过对以上三方面的研究与改进，优化了算法的实时性与鲁棒性。同时也降低了行人背景复杂时检测失败的出现几率，提高了行人检测的有效性与可靠性。

关键词　智能交通；行人检测；特征融合；卷积神经网络
 
Research on Pedestrian Detection Technology 
in Intelligent Transportation System
Abstract
With the continuous development of science and technology level, technology in intelligent transportation system (ITS) more perfect, its application scenarios and demand is growing. Compared to the traditional intelligent transportation system, technology, a new generation of intelligent transportation system based on hardware or the software algorithm is increasingly perfect, and already have real-time timely high-quality performance such as high accuracy and low rate of false positives. A new generation of intelligent transportation system through the study of the all-weather, continuous monitoring of road conditions, as well as the real-time monitoring data processing by computer technology to high efficient calculation, as a basis for realizing intelligent road traffic.The pedestrian detection module as an important part of ITS system has become the core of the domestic and foreign scholars research subject, it have broad prospects for development in the field of scientific research and engineering applications.
Pedestrian detection part of intelligent transportation system, this paper in-depth study and analysis, through the experimental analysis for high-definition cameras pedestrian images. Compared with the current popular pedestrian detection algorithm for experiments and in-depth analysis of improved algorithm is proposed in this paper. detection algorithm of job content are mainly concentrated in the following three aspects: first, Through image filtering, morphology processing and other related image processing technology, optimize the image sequence processing, retain the image on the basis of effective information less as far as possible the interference of redundant information; second, Selection of feature set, this paper selected different from the traditional feature set, single histogram of oriented gradient(HOG) feature and local binary patterns(LBP) features using statistical histogram cascade fusion, in order to get more deep more comprehensive image information; third, In part of the trained classifier to change the traditional way of training, it is using linear support vector machine(SVM) classifier, adopting intercepting convolution neural network as classifier, the use of three full connection layers for training, finally get good classifier performance. 
At this point, it optimizes the real-time performance and robustness of the algorithm through the research and improvement of the above three aspects . It also reduces the pedestrian detection in the complex background of failure probability and improves the effectiveness of the pedestrian detection and reliability at the same time.

Keywords   intelligent transportation system; pedestrian detection; feature fusion; convolution neural network 
 









第1章 绪 论
1.1 引 言
随着人们交通安全意识以及环境保护意识的不断提升以及经济建设的高速发展，智能交通系统（Intelligent Transportation System，ITS）也得到了快速长足的发展，目前各大相关企业公司正加大智能交通系统的研发投入，力争在不远的将来全面实现交通的智能化。智能交通系涉及学科众多，其中主要包括图像与信号处理、计算机科学、机器视觉、控制理论等众多学科。随着科研工作的持续深入以及其他相关领域的高速发展，智能交通系统也将迎来快速发展阶段，与此同时人们的生产生活需求也对该技术提出了更新更高的要求。
当今社会，对于一个国家而言，无论是发达国家还是发展中国家，由于人类科技的不断发展，城市化的进程不断推进，机动车的普及率逐年上涨。同时，对于一个现代化集成度较高的城市而言，可供交通规划的空间资源已经十分有限，在以上情况下，传统的解决交通运载力的方法。譬如，道路拓宽，桥梁架设等类似建设道路基础设施，提高路网通行力的方法已经不再适用于当下的交通发展背景。在此背景下，着眼于提高单位时间内机动车的通行效率显得尤为关键。在不大量兴建交通设施的前提下，将车辆与现有交通网相综合考虑，运用智能交通这一技术解决当下交通问题的解决方案就应运而生了。
智能交通系统的主要研究内容包括：行人目标检测、车辆控制与安全系统、电子收费系统、交通网络与通讯系统、交通监控与数据采集、智能车辆与驾驶辅助系统等[1]。本文对智能交通系统中行人检测部分深入研究改进。传统的依靠人工甄别或是早期算法甄别行人体态特征的方式，由于被检目标的周遭环境变化复杂，导致误检率与漏检率较高，限制了智能交通系统中准确甄别行人目标的发展。在此背景下，行人检测技术的实际工程化需求急待改进[2]。
基于上述原因，行人检测技术得到了学术界以及工业界的广泛关注，因此行人检测技术得到了真正的发展推进。以视觉为基础的行人检测技术便成为了智能交通系统发展应用的核心技术之一。同时也是开展行人行为预测、交通参数提取等后续工作的基础和前提。监控设备通过检测背景环境中指定区域的图像变化判断目标的体态及行为特征，以此作为依据提高对行人检测的准确率，再通过对目标物体的检测与获取，进而实现对行人的圈定以及后续的处理，后续处理包括对行人的跟踪检测，人群密度检测等，通过上述步骤的实现，可以对异常状况及时处理，缩短了从发现问题到对问题响应的时间，提高对道路实时信息的反应速度。提高事故处理效率，保障公民的生命财产安全成为了行人检测技术不断发展的重要驱动力。
1.2 智能交通系统概述
早在上个世纪60年代末人们就对道路功能智能化进行了设想。直到20世纪80年代，各发达国家政府为了解决当下日益严重的道路交通拥挤问题，同时在现有的路网承载力适应不了车辆急剧增长需求的大背景下，开始对智能交通系统进行探索研究。在上世纪80年代的科技水平下，由于很多现实技术以及某些理论技术的限制，只能够解决部分交通问题，尽管如此，在随后发展起来的早期ITS所带来的经济利润以及社会附加效益，使人们清晰的认识到ITS存在着的巨大发展潜力，因此使得ITS很快成为21世纪交通发展的主流方向。目前已经形成了主要以美国、欧盟、日本为中心的三大不同体系的ITS研究中心。
当前全世界对ITS的定义还没有统一的标准，但是对于交通智能化的需求却是基本相似的，如何将现有的道路交通网络与行人，机动车等通过先进的计算机处理技术以及数据传输技术有机的结合起来使得三者互相协调均衡发展，是智能交通系统需要解决的最大的难题。
1.2.1 智能交通系统的组成与发展
目前以美、欧、日三大ITS研究中心为主导，各个国家地区都在研发适合本地区的智能交通技术。现已形成产品多样化，适用性更加全面的技术分布，但ITS的核心技术并没有因此改变，依然围绕着5个主要方面发展，分别是交通管理系统，交通信息系统，车辆控制系统，公共交通系统以及电子收费系统[3]。
国外发达国家在对智能交通领域的研究投入了大量的资源，经过较长时间的深入研究，目前该技术已经日趋完善。目前，世界范围内ITS领域已经形成美欧日三大体系，各国根据自身发展需求以及技术优势，发展适合自身的ITS交通系统。1994年美国的IVHS America智能交通系统正式改名为ITS America。目前，美国ITS体系由7个子系统及各自的分系统构成，如图1-1所示。
 
图1-1 美国的ITS体系
Fig. 1-1 ITS system of the United States
欧洲由于各国领土面积较小，同时由于欧洲一体化进程的不断推进使得欧洲在智能交通系统的研究方面采取整个欧洲一体化的方针。欧洲的智能交通计划始于“尤里卡”联合开发与研究计划，并且衍生出多种新版本，其中包括：支持公交优先系统、INGRID事故检测系统以及车辆排放物的估算等。
日本是一个土地稀少人口众多的国家，但经济发展却处于世界前列，每天行驶在日本道路交通网上的车辆超过亿辆。日本建立了“先进道路运输系统”[4]。其中在1994年11月进行了电子不停车收费系统（Electronic Toll Collection，ETC）的实验，为最终选择5.8Hz作为通信频率提供了坚实的实验基础。直到1995年日本累计安装车辆导航系统的机动车数超过100万辆，同时基于GPS的车辆导航已经实现了商业化。日本将本国的智能交通系统细致划分为10个子系统，如图1-2所示。
 
图1-2 日本ITS体系
Fig. 1-2 ITS system of Japan
我国ITS体系架构：
自20世纪末，面对我国改革开发大潮，国民生产总值与日俱增，机动车保有量持续攀升，对此，我国政府在面对日益繁忙的交通网络逐渐意识到，对于本国的交通智能化建设要尽快的提上日程。通过相关的科研机构以及大量的研究人员对我国特殊国情以及背景进行深入研究，最终制定出符合我国自身的ITS体系框架。随后对ITS进行反复完善，最终在两千年左右由国家科技部编写，随后出版了第一版《中国智能交通系统体系框架》。2005年经过几年的实际开发后，积攒了大量对智能交通系统实践的最新信息，紧接着发布第二版《中国智能交通系统体系框架》，其在规范化，系统化，实用化等方面取得了实质性的进展。如图1-3我国的ITS智能交通系统体系结构图。
 
图1-3 中国的ITS体系
Fig. 1-3 ITS system of China
1.2.2 智能交通系统中行人检测技术的应用
在世界各个国家的智能交通系统中行人检测单元都是其重要的构成部分，如上文中提到的日本的ITS体系中尤为重要的一个环节就是“行人信息通信系统”，由此可见行人检测在智能交通系统中扮演者举足轻重的角色。
伦敦早在2014年9月份就开始使用了一种被称为Safewalk的行人检测系统，Safewalk系统开创了全球同类系统的先河。该系统可以对路况进行实时检测，计算当前等待通行的行人数量以及机动车数量，以此作为依据控制信号灯的变换，Safewalk的布设使得伦敦的延误情况减少12%，同时降低了交通事故的发生的几率，Safewalk作为同类系统的代表即是行人检测系统的一部分。
1.3 行人检测原理及发展现状
1.3.1 行人检测的原理
在行人检测领域中传统的检测方法主要分为两大部分，一是学习阶段，二是检测阶段。在学习阶段，首先对大量的行人数据集提取图像特征，随后通过机器学习算法对提取到的特征进行训练学习，最终目标是获取到一个高性能的行人分类器。对于检测阶段在智能交通系统中通过高清摄像机对路口进行实时拍摄，拍摄后的图像首先经过预处理部分，主要是对图像的背景噪声降噪以及在色彩空间进行形态学处理，随后对处理后的图像进行特征提取，形成图像的特征集，利用已训练好的分类器对图像特征进行判断。期间通过滑动窗口算法对整个图像进行遍历，遍历过程即是对图像中是否存在行人的判别过程。最终根据滑动窗口的匹配得分对图像中的行人进行位置标注[5]。
1.3.2 行人检测的国内外研究现状
目前，滑动窗口检测方法被广泛应用于行人检测领域。曾在国际视觉物体检测大赛中使用滑动窗口遍历的方法在人体检测的领域中占据主导地位，其检测结果优于其他的检测手段。滑动窗口算法的主要思想就是通过对缩放后的不同尺寸图像进行有穷尽的遍历，在窗口滑动过程中以一定的步长及方向遍历图像的全部范围。就行人目标检测而言，经过多年的发展研究，研究人员发现图像中行人的边缘信息对行人目标特征的刻画较为清晰深刻。因此，对边缘信息的采集以及处理是当下行人检测领域深入研究的出发点与重点。
上世纪末在行人检测领域中，研究人员根据人体的边缘轮廓、大小、形状信息构建出具有一定判别性能的模板[6]。在对检测图像的信息采集中，对图像的底层特征信息进行提取组合，将组合后的信息通过定性或定量的方式，与人体先验的模板信息进行比对，进而判断图像是否存在行人以及行人位置等信息。Shashua等人将尺度不变特征引入对行人的检测，将目标人体划分为13个局部区域，采集并计算每个区域的SIFT算子特征，再将融合后的特征利用自适应提升（Adaptive Boosting，Adaboost）算法训练弱分类器以此迭代形成性能优异的强分类器，利用这种方法对街道上的行人进行检测，获得良好的分类结果。2006年Dalai使用方向梯度直方图特征刻画人体，随后使用SVM对HOG特征进行分类训练，Dalai提出的HOG直方图特征很好的刻画了人体形态特征使得行人的判别度提高，这种方法的有效性被广泛承认。曲永宇等人提出将HOG统计特征与颜色频率、肤色相结合的特征来描述人体。这种方法在YcrCb颜色空间上着重分析了人脸肤色的聚合性，最终得到了良好的检测效果。华南理工大学黄茜等人将积分向量图与HOG特征相结合以此获取优质特征，随后使用线性SVM作为弱分类器进行训练，减少了数据特征维度，在保证检验精确度的基础上节省了大量的计算时间。
综上所述，HOG特征对人体边缘信息描述深刻，由此HOG特征的提取和应用极大的提高了人体检测的准确率，所以本文选择在HOG特征的基础上进行改进。
1.3.3 行人检测的重点和难点
行人检测是智能交通系统中的研究热点，涵盖了目标行人的分类、识别等研究内容。由于行人自身的多变性以及行人的背景复杂性，这使得建立一个准确的、高效的、以及实时的行人检测方法困难重重，所以行人检测是计算机视觉中的研究热点和难点[7]。其中比较难解决的问题如下：
1. 由于行人自身关节的活动范围较广，使得行人体态具备物体柔性性质，同时骨骼的原因也具备物体的刚性性质，这使得行人检测过程中行人兼具物体柔性和刚性的特性，加大了行人检测过程中对目标行人检测的难度。
2. 行人间的体态、外观等存在较大的差异性，由于行人自身的穿着、体型、姿态等各不相同导致的差异对检测产生干扰，容易造成检测失误，从而加大检测难度。
3. 自2011年以来，用于行人检测的训练样本库趋于大规模化同时检测精度
趋于实时化，因此行人检测日趋具备动态特性与实时特性，要求检测速度不低于2.58帧/秒，对行人实时检测提出较高的要求。
4. 在实际对行人进行检测的过程中，行人以及背景都是在动态变化的，这导致检测的背景比较复杂，动态变化的路况信息对检测的影响作用较大，这也是行人检测的难点。
综上，建立一套实时性与准确率都符合当下社会生产生活的行人检测系统还存在许多需要提升改进的空间，对此，改进行人检测算法提高算法效率成为解决以上提及问题的行之有效的方法之一。通过监控设备对道路交通上穿行的行人进行拍摄，随后，对图像进行检测算法处理，对图像中行人位置进行准确判定，最终找到最优解[8]。从视觉感官上看的实验结果就是尽量的使圈定窗口准确而紧密的圈定行人的同时尽量杜绝行人的局部体态的圈定。
1.4 本文主要研究内容及组织结构
本文对以下二方面进行深入研究：
1. 基于HOG-LBP特征融合的行人检测技术的研究。首先，通过对经典的基于HOG特征的行人检测算法进行深入研究，了解边缘特征的描述原理以及提取方法，随后，针对行人检测算法使用特征较单一的问题，利用基于HOG与LBP相融合的行人检测算法。通过HOG结合LBP作为特征集，能够有效降低遮挡，光照及噪声对行人检测的影响。首先固定Cell大小为6×6像素，对每个像素提取HOG特征，同时对每个像素再在6×6的窗口内进行LBP特征的提取。然后对每个Cell特征进行归一化得到单一block特征，级联后得到单一图像的特征集合。本文是在Cell层面上对HOG特征以及LBP特征进行串行融合。结果证明融合后的特征能够有效地提高行人检测的准确率。
2. 基于卷积神经网络训练分类器的行人检测技术的研究。在实验过程中利用传统的SVM进行训练分类器时发现线性SVM并不是最适合的分类算法，在线性SVM训练过程中存在一些参数较难确定，例如核函数中各阶系数、松弛变量等，这些初始的关键数据大多以人为地经验进行设定。对此，利用神经网络来进行特征分类。通过提取HOG-LBP特征，得到高维的特征向量，接着构建1×1的卷积模板得到单个神经元的特征映射图，然后再利用三层全连接层对特征向量进行分类，通过Sorftmax层输出分类结果，实验表明，神经网络分类器能够有效的降低误检，提高行人检测的准确率。
本文针对智能交通系统中行人检测算法展开论述。通过对时下国内外行人检测方面的成熟算法进行实验比较，同时结合各类算法自身的优点与局限，最终本文提出了一种可行性的算法改进。本文的行文流程以及章节安排如下：
第一章通过介绍智能交通系统的发展现状以及组成部分，了解课题研究的目的和意义，在此基础上，对国内外行人检测技术的发展背景以及近况进行了阐述，同时阐述行人检测研究中的重点以及难点问题，最终确定了本文的主要研究内容。
第二章根据视频图像序列处理流程，采用形态学方法对图像进行处理，用以减小原有图像噪声的干扰，对毛刺、孤立点以及细小孔洞等利用膨胀、腐蚀算法进行消除，同时利用图像灰度化处理降低图像冗余信息从而减少待处理的数据维度，最后通过图像分割技术实现图像特征信息的提取。
第三章简述行人检测算法的主要步骤，对当下流行的适用于行人检测的特征进行详细的分析研究，为之后实现HOG特征与LBP特征进行融合的实验准备充足的理论基础。随后介绍了在Matable平台上实现的过程。最后对行人检测的评测标准进行介绍，同时对用于测试论文中改进算法的INRIA行人数据集进行介绍。在本章的实验仿真及分析章节中给出使用单一特征与使用融合特征测试数据集的对比试验结果，证明改进算法的有效性与可行性。
第四章首先对深度学习理论进行深入的研究学习，了解深度学习算法被开发的时代背景以及替代原始的机器学习方法的原因，研究深度学习的理论知识，学习深度学习模型中的卷积神经网络算法，BP反向传播算法等，为之后的使用截断的CNN来训练分类器的实验准备充足的理论基础。在本章的实验仿真及分析章节中给出使用传统的支持向量机训练分类器与卷积神经网络训练分类器的对比试验结果，证明改进算法的有效性。
第2章 图像处理相关技术
视频的实质是由多帧静态图像连续播放时构成的动态画面。在行人检测领域中可以通过感兴趣区域将图像中行人目标的特征提取出来，为后续的检测以及跟踪提供依据，因此对视频图像的处理至关重要，是开展后续工作的前置条件，同时也是提高行人图像检测精度的重要保证。
 2.1 图像处理相关基础知识 
智能交通系统中监控设备是其主要的信息采集方式[9]，然而由于外界环境复杂以及摄像机自身拍摄清晰度受限等原因，使得在拍摄行人图像的过程中时常出现图像模糊、失真、不清晰等非人为操作的不可控情况，因此，对拍摄到的图像进行必要的图像上尽可能的减少冗余信息的干扰，最终为后续的特征提取提供完整的图像信息。预处理操作就显得尤为关键。通过对图像预处理操作使得图像在保留有效信息的基础。
2.1.1 图像滤波处理
图像滤波的目的在于，在保留图像细节特征信息的基础上尽可能的消除冗余信息的干扰同时对噪声进行抑制，图像滤波处理图像预处理中不可或缺的重要环节，其滤波处理后的图像效果对后续的图像分析至关重要。实际上图像滤波的过程也是对图像进行增强处理的过程，图像滤波处理即是图像增强技术[10]。图像增强技术是一种加强图像判读和识别效果的图像处理方法。
图像增强技术大致可以规划为两种处理方式即空间域法与频率域法[11]，对于空间域法，当前局部求平均值法和中值滤波法作为空间域法的代表，可以用于去除或减弱噪声干扰。而频率域法则是将图像信息当作二维信号变换到傅频域中进行运算处理，基于二维傅里叶变换的信号增强技术。采用低通滤波法，可去掉图中的噪声；采用高通滤波法，则可增强边缘等高频信号，减少原有图像噪声信号同时增强图像边缘信息使得图像清晰度增强。由于空域与频域间的变换运行时间较长，所以不适合用于要求具有较高实时性的行人检测中。而基于空域的算法处理时直接对图像灰度级做运算，对灰度值进行运算的方法较与在频域内对图像进行变换更省时，所以本文在图像预处理过程中使用的是空间域法对输入图像进行预处理。
空域滤波的处理方式主要有三种滤波方式。第一种、高斯滤波是一种线性平滑滤波，适用于抑制高斯噪声，主要针对符合高斯分布的噪声进行处理[12]。被应用于降噪过程中，对图像噪声具备很好的抑制作用。但是适用范围较小。第二种、均值滤波是典型的线性滤波算法，可以对图象进行平滑处理，其核心部分是用模板中的全体像素的平均值来代替原来像素值，算法易于实现，主要对图像中的高频噪声部分进行滤除，滤波效果较好。第三种、中值滤波是一种非线性处理技术，能抑制图象中的噪声。具体做法是将像素序列中某一点的灰度值用与此点相邻的各个点的灰度值的中值进行替换，可以有效地抑制椒盐噪声，满足ITS系统对于交通状况监控的实时性需求。
通过上文介绍，对当下常用的三类滤波原理进行学习，根据实验图像的特性最终本文在预处理阶段采用中值滤波方法，中值滤波的基本原理是把数字图像或数字序列中一点的值用该点的一个邻域中各点值的中值进行替代，使得周围的像素值接近真实值，从而消除孤立的噪声点。中值滤波是一种非线性信号处理方式，设相近区域内有 个像素点，按照灰度值由大到小的顺序排列为 ，采用中值滤波方式后该像素点新的值为公式（2-1）所示。
                 （2-1）
2.1.2 图像灰度化处理
图像的灰度化处理实质上就是将彩色图像转化成为灰度图像的过程。在图像转换过程在保持了图像特征信息的基础上降低了图像色彩的信息量，所以在数字图像处理中一般先将各种格式的图像转换为灰度图像以使后续图像计算量减小一些。彩色图像中的每个像素是由R、G、B三个分量构成，而每个分量的取值范围为[0,255]，这样一个像素点可以有255×255×255种变化可能，对此需要处理的数据量巨大不适合进行快速运算。而灰度化后的图像不再具有R、G、B三个分量，可以使用同一种特殊的彩色图像进行度量，其一个像素点的变化范围为255种远远小于255×255×255种，方便对图像进行快速运算。灰度图像的描述与彩色图像一样，仍然反映了整幅图像的整体和局部的色度和亮度等级的分布和特征。常用的灰度化处理方法如下： 
	加权平均值法，首先对图像的三个分量赋予不同的权值VR、VG、VB，然后进行加权平均，令该值为灰度值 ，表达式如下
             （2-2）
2. 最大值法，取像素的三个分量中的最大的一个分量，令该值为灰度值 ，表达式如下
                （2-3）
3. 平均值法，对R、G、B分量值做均值处理，令该平均值为灰度值 ，表达式如下
                （2-4）
采用最大值法对图像进行灰度化处理的过程中，由于选取的R、G、B三通道均为最大值，故亮度相较于其他两种灰度处理算法较高；采用平均值法处理形成的灰度图相对柔和；而采用加权平均值法比较适合人眼感光习惯，经过处理后的灰度图效果最好。加权平均值法的R、G、B三通道的权重值一般设置为 即 时输出图像。
2.1.3 图像分割
图像分割即是指依据图像自身的特性，将图像划分为不同的区域[13]。将图像分成若干个特定的、具有独特性质的区域。图像分割是计算机视觉的基础，也是图像预处理过程中的关键技术。在像素级上将具有相似特性的区域划分为同一类，反之将特性相异的区域进行区分，图像分割是图像预处理过程中重要的一环。设集合R表示一个完整的目标图像，同时满足如下条件： 
1． ；
2． 是一个连通集， ；
3． ，对于所有i和j，  ；
4．  ；
5． ，对于任何 和 的邻接区域。
2.2 形态学处理
数学形态学是一种用于分析图像的几何形状与结构的数学方法[14]。二值形态学的基本运算包括腐蚀、膨胀、开运算、闭运算这4种运算，其中开运算、闭运算是在腐蚀运算与膨胀运算基础上进行的[15]。这4种形态学运算在对灰度图像的处理上各有特点，可以利用这4种基本形态学算子对图像的结构与形态进行分析处理，其对图像具体的处理操作包括特征抽取、图像滤波、图像增强和恢复等[16]。
二值形态学对图像处理的实质是利用形态学的基本算子B对通过滤波处理后的像素集合A进行运算，通过集合B与集合A作交、并等逻辑运算，达到去噪点、填补空洞等处理的效果[17]。下面介绍几种常用的运算方法。膨胀运算与腐蚀运算：膨胀算法使得目标图像的边缘扩大，能够对图像边缘或内部的小于结构元素的孔洞进行填充。膨胀是将与物体接触的所有背景点合并到该物体中，使边界向外部扩张的过程。尽管可以用来填补图像中的空洞，但该运算也会导致目标区域的增大，因此当两目标距离较近时使用此法误差较大。膨胀运算定义如公式（2-5），记作用 膨胀 ，其中 为空集。算法首先算出集合 相对于自身原点的映射，再分别求该映射平移 后与集合 交集至少有1个非零元素时 的原点位置的集合。
                   （2-5）
腐蚀运算是膨胀运算的对偶运算，与膨胀运算相反，腐蚀运算可以把小于结构元素的目标去除。所以可以利用较大结构元素的运算处理两目标之间存在的轻微连通，完成连通部分的去除。腐蚀运算定义如下
                    （2-6）
                 
（a）灰度处理             （b）膨胀效果            （c）腐蚀效果
（a）Grey prcessing        （b）Effect of inflation     （c）Effect of corrosion
图2-1 运算效果对比图一
Fig. 2-1 Operation effect contrast figure 1
记作集合A对集合B进行腐蚀运算。膨胀与腐蚀运算的处理效果如图2-1所示（a）为灰度化处理后的原图像，（b）经过为膨胀运算后的效果图，（c）经过为腐蚀运算后的效果图。从运算处理后的图像可以看出，经腐蚀处理后将小于结构元素的噪点消除，行人图像整体向内聚合；经膨胀处理行人边缘效果较好。
如果对图像先进性膨胀运算再进行腐蚀运算即为闭运算，反之，对图像先进性腐蚀运算再进行膨胀运算即为开运算。开运算与闭运算与膨胀和腐蚀的关系一样，开、闭运算也是对偶运算。开运算即对图像使用结构元素B腐蚀运算，而后进行膨胀运算，开运算定义如下
          	            （2-7）
反之，如果对图像先使用结构元素 膨胀运算，而后进行腐蚀运算，则为闭运算，开运算与闭运算的处理效果如图（2-2）所示，其定义如下
                	      （2-8）
             
（a）开运算                    （b）闭运算
（a）Open operation             （b）Closed operation
图2-2 运算效果对比图二
Fig. 2-2 Operation effect contrast figure 2
2.3 颜色空间
颜色是物体所具有的最直观的外部特征。颜色通常用三个相对独立的属性进行描述，三个相互独立的变量综合作用，便构成一个空间坐标，这就是颜色空间。从本质上来说第一种是基色颜色空间的。典型的是RGB颜色模型，第二种是基于色、亮分离颜色空间，其中包括HSV模型、YUV模型、HIS模型等[18]。针对不同环境，选择不同的颜色模型表征图像信息十分必要。下文将对RGB颜色模型以及HSV颜色模型进行分析研究。
2.3.1 RGB颜色模型
自然界中的所有颜色均可以由这三个分量按不同配比混合而成，我们称这三种颜为三基色。我们将由 、 、 三个分量构成的向量称为RGB色彩空间。 、 、 表示三基色的分量，则任意颜色的配比公式如（2-9）所示
                  （2-9）
为了更为直观的表述RGB颜色模型，通过笛卡尔坐标系，更为清晰的描述了RGB颜色模型。该坐标系的三个坐标轴X、Y、Z分别表示三基色，如图2-3所示。RGB 颜色空间是一种色彩模型，利用多种颜色的混叠可以得到其他不同种类的色彩。RGB颜色空间是人们认识色彩最早最简洁的颜色模型，我们可知的自然界中任何一种颜色都可由三种基色按不同的比重进行混叠相加获取，当像素点的三基色分量都为0时即混合得到黑色光即坐标系原点 位置；当像素点的三基色分量都为最大值255时混合为白色光即点 ，黑色与白色两点间的距离代表灰度量级差。其中红、绿、蓝为三基色，而余下的顶点则代表每一种基色的补色。任一色彩L是这个立方体坐标中的一点，且各个坐标轴上的投影表示该点红、绿、蓝三个分量的亮度值。调整三基色系数中的任一系数大小都会改变L的坐标值，也即改变了L的色值。
 
图2-3 RGB颜色空间
Fig. 2-3 RGB color space
由于RGB色彩模型采用三个基色分量对图像中的像素点进行刻画，这种描述方法虽然简洁直观，但并不能全面深刻的描述符合人眼观察外界环境时所需的成像信息，所以对于研究与颜色模型相关的内容时需要多加考虑。RGB色彩空间采用物理三基色表示，优点是物理意义清晰便于理解模型空间，但是，该颜色模型分布不均匀，描述不同色彩时对象素点处理较为繁琐，且容易被光亮照度影响，因此这一模型并不是最适合描述色彩的颜色空间。由于上述原因，人们在RGB颜色空间的基础上创造出了更符合人眼观测的颜色空间，譬如，HSV模型、YUV以及HIS模型等。
2.3.2 HSV颜色模型  
HSV模型的三维表示是由RGB颜色空间演化而来。根据图像自身信息即颜色的色度、饱和度及明亮度，三个特性对RGB颜色模型进行转化，据此我们可以确定HSV颜色模型。HSV模型更符合人眼视觉，较之RGB颜色模型也更为直观。其中 表示色度，色度即颜色的基本属性，用角度度量，取值范围为0°~360°。 表示饱和度，饱和度即颜色的纯度，数值越高，色彩越鲜明，取值范围为0.0~1.0，值越大，颜色越饱和。 表示亮度，亮度即人眼感受到物体表面反光程度的物理量，又称明度，取值范围为0（黑色）~255（白色）。RGB颜色模型可以通过公式（2-10）（2-11）（2-12）转换到HSV颜色模型
              （2-10）
                      （2-11）
                        （2-12）
其中， 分别表示R、G、B三个颜色分量的最大值与最小值。
1978年，A. R. Smith首创了该理论。他根据RGB三维色彩空间的模型，基于三基色的非线性变换，创建了三维圆锥体用以描述HSV颜色模型如下图2-4所示。HSV颜色模型的模型对应于圆柱坐标系中的一个圆锥形子集，HSV由三个色彩元素进行表示，较之RGB空间模型其携带的图像信息更加全面，三个颜色元素分别为：色彩（H）、色饱和度（S）、明度（V）。饱和度S取值从0到1，所以圆锥顶面的半径为1。圆锥的顶面中心处 ，代表白色。从该点到原点亮度渐暗降低，即具有不同灰度值的灰色。对于这些点， ，H的值无定义。可以说，HSV模型中的V轴对应于RGB颜色空间中的主对角线。
 
图2-4 HSV颜色空间
Fig. 2-4 HSV color space
2.4 本章小结
本章主要的工作内容集中在图像的预处理过程，采用形态学方法对图像进行处理，以此减小原有图像噪声的干扰，对毛刺、孤立点以及细小孔洞等利用膨胀、腐蚀算法进行消除，同时利用图像灰度化处理降低图像冗余信息从而减少后续计算量，最后通过图像分割技术实现图像特征信息的提取。本章节为后续基于特征融合的行人检测提供了优质的图像来源，高质量的预处理图像是特征提取的前提保障。
第3章 基于特征融合的行人检测算法的研究
特征提取对行人目标检测至关重要，提取到的图像特征用于对分类器的训练，特征是否优质直接影响分类器的分类性能，本章将对当下具有代表性的特征进行分类并简述各自的优缺点。
在行人检测领域中行人的特征描述子大概可以分为三种类型：一、底层特征；二、基于学习的特征；三、混合特征。边缘特征，纹理特征，HOG特征，LBP特征属于底层特征，底层特征的优点是特征单一，易于计算，可以利用积分图技术对底层特征快速计算，所以利用底层特征训练的行人检测系统具备实时性的能力，但由于使用单一方面的特征导致对行人目标特征的刻画不够深刻所以判断力较差准确率较低[19]。基于学习的特征优点在于通过不断的迭代学习过程能够从大量的样本中选择出判别能力较强的特征，缺点是对训练样本的依赖性较强，容易出现过拟合的现象，出现对训练样本集进行测试时结果优异，而对于除测试样本外的其他样本集的测试结果较差的现象。对于混合特征而言，优势在于能够从不同的角度刻画图像的特征从而提高检测的准确率，劣势在于融合后的特征维数较高，融合特征的计算时间较长，影响实时性。但随着半导体行业的快速发展，芯片的制造工艺不断提高，新的具备高性能的GPU不断涌现，使得基于混合特征提取的行人检测逐渐具备了实时性的功能。基于上述描述，本文确定使用混合特征的方式对图像信息进行提取，使用单一的底层特征即HOG特征与LBP特征进行融合最终使用融合后的HOG-LBP特征作为分类器算法的训练集。
3.1 行人检测的整体流程
3.1.1 行人检测整体流程
行人检测算法按照算法处理的先后顺序分为三个关键内容，其中包括：1、通过训练数据集训练分类器；2、利用训练好了的分类器检测图像数据；3、对检测结果进行后处理操作，对重复检测以及误检窗口进行抑制。目前行人检测技术中最核心的两个问题是特征提取与分类器训练[20]。
在训练部分会对输入图像进行预处理操作，其中包括对图像进行灰度化处理，使得保全图像特征的前提下尽可能的减少输入图像的色彩信息，减少无用的数据量，其次利用伽马（Gamma）校验对图像进行归一化处理。再对经过预处理后的图像进行特征提取，提取到的数据用于分类器的训练，最终获得分类器。检测部分主要是通过滑动窗口算法对测试图像进行遍历同时对每个窗口进行打分，分数越高越容易检测为包含行人的窗口，反之分数较低的窗口会在后处理部分中被滤除。利用训练得到的分类模型对测试图像中是否存在行人进行判断，若判断为存在行人则标定出行人位置。后处理部分主要是利用非极大值抑制算法对标定出的窗口抑制重复检测，得到高分的检测窗口使得对行人的标定更加准确。如图3-1所示行人检测的流程结构，A部分是学习阶段，B与C部分是检测阶段，细致分解A，其中包括特征提取阶段以及训练分类器阶段，B是对测试样本进行检测的阶段，C是对检测后的结果进行后处理的阶段即对误检窗口进行抑制的阶段。
 
图3-1 行人检测流程图
Fig. 3-1 The flow chart of the pedestrian detection
3.1.2 实验环境配置
本文的实验主机配置如下：处理器采用Intel（R） Core（TM） i3-5005U；主频 2.00GHz；内存容量8.0GB；显卡1、AMD Radeon R5 M200 Series，2、Intel（R） HD Graphics 5500；硬盘ST500LT0 12-1DG142 SCSI Disk Device （500GB）；主板20DCA077CD （SDK0K09938 WIN）。
利用MATLAB软件提供的图像处理算法搭建运行框架并对算法进行实现。系统主要是实现基于混合多尺度可变形部件模型检测算法。根据算法，我们将系统分成个重要的步骤：
1. 对HOG特征与LBP特征分别进行提取，形成HOG-LBP特征。
2. 利用特征集向量对线性SVM进行分类训练，最终得到分类函数（超平面），并利用最小二乘算法获得最优分类函数的参数。
3. 通过在INRIA数据集的测试集进行实验，定量的得出在不同测试样本量下的精确度，通过对不同特征采用相同分类算法的实验得出对比结果。
4. 利用最终检测窗口的得分计算得出漏检率和误报率，根据漏检率和误报率画出DEC曲线与ROC曲线作为系统性能的衡量指标。
3.1.3 行人数据库及评测标准
本文中用于训练分类器的数据集取自目前使用最普遍的静态行人数据库：INRIA行人数据库。INRIA行人数据库分为训练集和测试集合两大类， 其行人数据集的图像主要取自GRAZ-01、个人照片及Google图像，因此图片具有较高的清晰度。这些图片相比于MIT、Daimler等行人数据集，行人的光照情况与姿态都更加复杂，适合做行人检测。这些样本中包含了各种各样的变化，如：光照条件不同、拍摄角度多样、行人的动作姿态丰富、行人是否遮挡是否携带物件、与行人形状相似的物件等。
INRIA提供原始图片及相应的标注文件。训练集中的正样本均采用64×128像素大小。实验中用到的正样本即包含行人与负样本即不包含行人如图3-2与图3-3所示，下图展示的是训练集合中的部分正负样本。从图中我们可以观察到INRIA行人数据集采用了不同角度，不同光照的图像集，使得INRIA数据集更具自然性代表性。这也是近年来行人检测领域大多采用此数据集的原因之一。
 
图3-2 INRIA部分正样本
Fig. 3-2 Some positive samples of INRIA
 
图3-3 INRIA部分负样本
Fig. 3-3 Some negative samples of INRIA
3.2常用行人检测特征及其计算方法
在行人检测系统中，特征提取是整个系统的核心部分之一[21]。提取一个优质的特征意味着我们有更大的机会训练得到一个高效精确的检测器。总的来说此部分的主要工作就是提取高效特征，下面介绍三种常用在行人检测领域中的优质高效的特征算法，为后续使用的HOG-LBP 特征融合提供理论基础。
3.2.1 HOG特征
HOG特征也称为梯度方向直方图特征，是目前广泛使用的行人特征描述子[22]。如图3-4通过HOG特征对原始图像提取后的特征图，从图中可以观察到HOG特征对于图像的边缘信息刻画的较为深刻。
                   
（a）人体背面HOG特征图          （b）人体正面HOG特征图
  （a）Body negative feature maps       （b）Body positive feature maps
图3-4 HOG特征图
Fig. 3-4 HOG feature graph
HOG特征用于刻画图像的梯度值与梯度方向两方面特性，基于梯度特征、对block单元的特征向量进行归一化处理 、允许block之间相互重叠，因此对光照条件的改变与少量的偏移并不敏感具备光照不变性，能有效地刻画出人体的边缘特性[30]。在一副图像中，梯度或者边缘的方向密度分布能够很好的对行人目标的形态进行描述。原因是边缘位置储存着大量的对梯度的统计信息，因此HOG特征对图像的边缘特征刻画深刻[23]。
HOG算法的实现原理如下：将整幅图像分割成block单元，每个block中分成更小的细胞连接区域，称为Cell，HOG得到的描述子保持了几何和光学转化不变性除非物体方向改变。其Block与Cell关系如图3-5所示，图中所示每个block单元包含2×2个Cell单元，其中每个相邻的block区域允许重叠，这样做可以使得相互临近的block之间相关性加强，使得HOG算子对光照、偏移等图像中环境条件的改变具有良好的适应性。
 
图3-5 Block与Cell关系
Fig. 3-5 The relationship between Block and Cell
本文中设计的每个Cell中包含8×8个像素，使用的梯度模版是一维模版 ，因此我们可以通过公式（3-1）与（3-2）计算像素的水平和竖直梯度，接着利用公式（3-3）进行梯度大小和梯度方向的计算。
           （3-1）
           （3-2）
其中 和 分别表示输入图像中像素点 出的水平方向梯度和竖直方向梯度。
          （3-3）
 
然后对其中的每个像素进行梯度的计算并统计方向，利用梯度大小进行加权生成一个Cell的特征向量，对于梯度方向的统计本文中设置9个通道的直方图来统计这8×8个像素的梯度信息。直方图的方向bin在0°至360°之间均匀分布。
为了减少可能的重叠现象的出现，在梯度方向投票时相邻bin的中心之间需要进行方向和位置上的双线性插值。投票的权重根据梯度幅值进行计算。但实验表明，使用梯度本身作为投票权重效果最好。将360°均匀分为9个方向即9个bin通道，从0°开始每20°划分一个区域，计算一个Cell单元中8×8个像素的梯度方向 。确认一个Cell中的每个像素点的 所落在的方向区域并进行统计，同时计算得到的梯度大小 作为该像素点在梯度方向直方图上的权值，在统计梯度方向直方图时权值 乘以落在此bin中的像素个数如图3-6所示，9个bin通道分别从A1到A9。
 
（a）梯度方向分配图                   （b）梯度方向直方图
（a）Distribution diagram of Oriented Gradient  （b）Histogram of Oriented Gradient
图3-6 梯度方向统计
Fig. 3-6 Statistic Gradient Direction
但是由于局部光照的变化以及?背景对比度的变化，使得梯度强度的变化范围非常大，为改善准确率，局部直方图可以通过计算图像中一个较大区域块的光强作为尺度被对比标准化，然后用这个值归一化这个区域中的所有cell。这样做保持了几何和光学转化不变性，然后统计一个block区域的全部cell单元的特征，形成单一block区域的高维特征，得到单一block特征向量后连接上下block区域的特征向量，形成整张图像的HOG特征向量。
3.2.2 LBP特征
LBP，即局部二值模式。LBP算子定义为一种灰度尺度不变的纹理算子，是从局部邻域纹理的普通定义得来的[24]。
LBP特征是一种用来描述图像局部纹理特征的算子，具有很好的旋转不变和灰度不变性。提取过程具体如下：先获取任意一幅图像中像素 ，以中心点 的灰度值为阈值，对 做二值化处理，如公式（3-4），最终得到的T为 的二值化结果
 
                        （3-4）
然后，在该邻域内按照顺时针方向读出一个二进制数，即为该邻域的LBP二进制码。LBP二进制码提取过程如图3-7。
 
图3-7 LBP二进制码提取示意图
Fig. 3-7 LBP binary code to extract the schematic
对于上述的局部二值模式算法存在一个问题即只可取到区域为3×3的局部范围，为了能够适用于不同尺度的纹理特征，Ojala等对LBP算子进行了改进使其从单一的3×3领域扩展到任意领域[25]。不同的需求如图3-8所示，图3-8（a）的 代表半径为1的范围内采纳8个采样点，图3-8（b）的 代表半径为2的范围内采纳16个采样点，图3-8（c）的 代表半径为2的范围内采纳16个采样点。
 
	     （a）            （b）            （c） 
图3-8 几种不同的LBP算子
Fig. 3-8 Several different LBP operator
对于采样点的坐标我们可以根据公式（3-5）计算得到，其中 为邻域中心点， 为某个采样点。通过上式可以计算任意个采样点的坐标。
 
                    （3-5）
但是计算得到的坐标未必完全是整数，所以可以通过双线性插值来得到该采样点的像素值。如果我们想得到点 的值，假设我们已知函数f在四个点的值。我们选择一个坐标系统，假定已知四个点的坐标分别为    那么双线性插值公式就可以写作公式（3-6）所示，公式（3-7）为双线性插值用矩阵表示的形式。
   （3-6）
          （3-7）
通过上述对LBP算子的描述，我们可知，对于一张图像中的所有像素点均可以利用LBP算子进行提取得到此像素点的LBP编码，但是，由于上述LBP算子的提取过程是通过周围邻域的二值化处理得到的，所以上述LBP算子与位置的信息是密切相关的。但是在行人检测过程中，由于高速摄像机拍摄到的图像序列中行人位置是持续变化的，上述的LBP算子对于行人检测要求的实时圈定是不利的，对此在上述LBP算子的基础上进行统计直方图的构建。
在LBP算子的实际运用中，如行人检测、面部识别、车牌识别等，一般不会将LBP图谱直接作为特征向量用于分类识别，而是采用LBP特征谱的统计直方图作为特征向量用于分类识别，如图3-9通过LBP算子提取到的图谱。
           
（a）原图               （b）LBP图谱
（a）Original image           （b）LBP maps
图3-9 LBP特征图
Fig. 3-9 LBP feature graph
划分时需要参考图像的尺寸大小以及其他条件。譬如，在本文中使用的特征是将HOG与LBP进行融合后的特征，那么在提取LBP统计直方图特征时就要考虑到HOG统计直方图的提取单元大小。由于实验证明HOG特征提取时最适合的单元划分就是1个block包含2×2个Cell单元，1个cell单元包含8×8个像素点，所以确定了LBP划分的子区域大小最好为一个block的大小即包含2×2×8×8个像素点。
3.3 基于HOG-LBP特征融合的行人检测
LBP算子计算简单精准度高，对于图像的纹理特征刻画深刻，但对图像的特性提取不够完整，对于图像的边缘信息忽略较多。当对复杂图像的特征提取时准确率较低。{涛等人提出的多级LBP直方图序列特征，提取图像的局部特征和整体特征，将不同级的LBP直方图特征进行融合[26]。但是得到的融合后的特征依然是纹理特征的组合并没有融合到能够描述图像其他性质的特征。
在行人检测中，图像的轮廓信息特征尤为重要，LBP算子提取了图像的纹理特征而忽略了图像的边缘特征，而HOG算子正是着重提取图像的边缘[29]信息特征。HOG特征描述的是图像局部形状变化，将位置和方向进行量化。能够有效地进行边缘和方向特征的提取。
对此，本文中使用了增广的特征向量，将HOG特征与block结构的LBP特征进行融合。形成增广的HOG-LBP特征向量。这两种特征在图像的信息方面形成互补，使得融合后的特征可以更全面的记录图像特征。当检测图像的背景内容具有较高的噪声边缘时，HOG特征的处理效果较差，此时我们可以相应的加大LBP特征在融合中的权重，依据LBP特征进行分析。反之在纹理信息不明显而边缘信息丰富时，我们可以加大HOG特征在融合中的权重，实现优势互补的效果。
3.3.1 特征融合
本文利用HOG-LBP特征融合的方式来训练分类器得到全局分类器和部件分类器[27]。HOG特征训练LibSVM得到全局滤波器，LBP特征训练LibSVM得到局部滤波器，全局滤波器对图像进行全局的检测，将难以判断的区域（可行性阻塞区域）记录下来，然后利用LBP特征训练的LibSVM进行阻塞区域的检测，由于LBP特征能够很好的度量像素临近区域的纹理信息，从而能够有效的对阻塞区域进行检测判断，提高检测准确率，降低误检和重检。图3-10给出了本算法的流程图[28]。
 
图3-10 基于HOG-LBP特征融合的行人检测流程图
Fig. 3-10 Based on HOG-LBP feature fusion of pedestrian flow chart of detection
将HOG特征空间设为A，LBP特征空间设为B，对于任意模式样本 设它对应的两个特征向量分别为 和 ，串行融合后的特征矩阵 ，若特征向量 分别为n维和m维，由组合原理可知，其组合后的串行特征空间为（n+m）维。并行融合后的特征矩阵 其中i为虚数单位。若两组特征α与β的维数不等则低维的特征向量用零补足，此时特征矩阵维数为 ，串行特征向量的计算过程如图3-11所示，分别计算HOG特征直方图与LBP特征直方图，串行连接形成联合直方图。
 
图3-11 HOG特征和LBP特征的联合直方图
Fig. 3-11 The joint histogram of HOG features and LBP features
3.3.2 实验仿真及分析
在3.3.1小节中，我们对HOG-LBP特征融合的提取方法进行了详细阐述，本节中将对当下流行的行人检测特征进行实验比较。
我们基于HOG-LBP特征，结合线性SVM分类算法训练的分类器，在INRIA行人数据库上进行实验分析，对行人目标进行检测实验。实验数据如表3-1所示。从实验结果可以看出，HOG-LBP特征在INRIA行人检测精度上表现不错，其在不同的样本数量上采用HOG-LBP特征的行人识别率总体分布在94.10%左右。
表3-1  HOG-LBP特征在INRIA数据集上的行人检测结果
Tab.3-1  HOG - LBP features in INRIA data set on the pedestrian detection results


100
	
200
	
300
	
400
	
500
	
600

HOG-LBP 	92.1%	92.32%	94.2%	93.89%	95.8%	96.3%
接下来我们对HOG-LBP特征进一步进行实验分析，将HOG-LBP融合特征与其他优质特征进行横向比较。为了与其他优秀特征进行比较。我们在IINRIA数据集上进行定性特征的实验，以此验证HOG与LBP融合后的特征具备较高的精确度。实验使用的数据集依旧来自INRIA行人库,分类算法统一使用线性SVM，实验结果如表3-2所示。
表3-2  不同特征在INRIA数据集上的行人检测结果
Tab.3-2  Different features in INRIA data set on the pedestrian detection results


100
	
200
	
300
	
400
	
500
	
600

HOG	84%	91%	91.5%	89.89%	90.50%	90.8%
LBP	85%	82.30%	86.7%	87.2%	86.9%	87%
SIFT	70%	66%	65%	63%	63.30%	63%
HOG-LBP	92.1%	92.32%	94.2%	93.89%	95.8%	96.3%
从上述实验结果可以看出，在同等条件下，用于行人检测的主流HOG特征表现优异，在行人识别率中具有较高的精度，基本识别率在90%上下。LBP特征在行人目标识别中表现不错，识别率在80%至90%的区间中。SIFT特征尽管具备良好的尺度不变特性但是检测精度不够理想，识别率在65%左右需谨慎使用。最后HOG-LBP特征在INRIA行人数据集上的识别精度最高，达到94.10%左右。验证了HOG与LBP特征融合的效果，证明融合效果有效。
表3-1与表3-2均以检测精度作为衡量标准，从检测精度出发，以样本量与特征类型作为实验变量，在统一的测试数据集以及相同的线性SVM作为分类手段进行实验比较。下面将从“负利率-漏检率”角度进行实验分析，横坐标为每个窗口的负例率，即算法对检测窗口内所包含的图像信息进行判别，将负样本（非行人）误判为正样本（行人）的比例。纵坐标为漏检率，即在检测窗口范围内将没有行人目标的区域判断为有行人目标存在的比例。
在测试数据以及分类器统一的实验条件下，分别绘制使用HOG、LBP、SIFT、 HOG-LBP四种不同特征进行行人检测时的“负利率-漏检率”折线图。实验结果如图3-12所示。其中测试数据集与分类算法保持统一，均为INRIA行人数据集与线性SVM分类器。
实验结果显示，无论是否在遮挡状况下采用HOG-LBP特征进行行人检测的算法，其在相同的负利率下具有更低的误检率，譬如在负利率为15%时采用HOG-LBP特征的检测算法的漏检率为0.05%；采用HOG特征时漏检率为0.087%；采用LBP特征时漏检率为0.115%；采用SIFT特征时漏检率为0.15%。实验结果证明基于HOG-LBP特征融合的行人检测算法能有效的降低误检率与窗口负例率。
 
图3-12 负利率-误检率
Fig. 3-12 Negative interest rates - error detection rate
3.4 本章小结
本章针对行人检测的特征选取部分进行了深入研究分析，同时对当下流行的几种用于检测行人的特征进行深入学习，在学习过程中了解每种特征的优缺点。针对由单一特征集训练出的分类器，在判断具有复杂背景的行人图像时准确度偏低的问题，本文引入了底层特征融合的方法即将HOG特征与LBP特征通过直方图串联形成新的融合特征。HOG-LBP融合特征补充了单一特征对图像刻画不够全面的问题。通过与采用单一特征进行行人检测的算法进行实验对比，验证了改进算法的有效性与可行性。
第4章 基于卷积神经网络的行人检测算法的研究
4.1 分类器的训练算法
在行人检测的整体流程中，特征的提取至关重要，提取到的特征会被直接用于分类器的训练。那么通过上文的工作已经获得对图像刻画较完整的特征集合即HOG-LBP特征。下面就是对分类器进行训练的阶段，现阶段在行人检测领域中流行的分类算法如表4-1所示。
分类器的训练属于机器学习领域的范畴。通过机器学习理论对判别行人信息的分类器进行训练，是行人检测系统的重要组成重要部分，本章将对行人检测领域中常用的机器学习算法进行深入学习研究，从而为后文利用全连接层的卷积神经网络训练获取分类器打下理论基础[29]。
表4-1  行人检测常用分类算法
Tab.4-1  Pedestrian detection commonly used classification algorithm
分类器名称	分类原理
支持向量机（SVM）	引入核函数对线性不可分问题升维到高维空间转化为线性可分问题再进行分类训练
AdaBoost	一种迭代算法，将一些弱分类器用加权平均的方式组合成一个强分类器
卷积神经网络（CNN）	可获得类间的高非线性的分界线，能通过减少自由度的方式利用较少的样本完成训练
串联分类器	用快速但分类性能差的分类器的输出作为分类性能好但速度较慢的分类器的输入，以这样的方式串联多个分类器，优化分类精度和速度
4.1.1 支持向量机
SVM是机器学习中一个重要的分支，属于有监督的学习模型，由Cortes和Vapnik于1995年首先提出的学习算法[31]。SVM是一种基于统计学习理论的新型机器学习方法，具有出色的学习性能。由于它独具的核函数的引入使得在解决小样本、非线性及高维模式识别中表现出许多特有的优势，在多种数据集的分类任务中取得了较好的成绩[32]。
支持向量机通常用来解决分类、回归分析以及模式识别等问题。因此在行人检测领域中SVM得到了广泛的应用。实际上对于图像上的行人信息进行检测可以抽象为一个二分类的最优化问题。对图象上局部位置或是全局位置判断是否存在行人即是二分类问题，那么最优化就是指寻找到一个可以区分行人图像（正样例）与非行人图像（负样例）的最优分类决策。SVM理论的提出推进了机器学习在人工智能领域的发展，为后续算法的提出指引了方向。SVM相较之前的机器学习方法优势主要体现在以下几方面：
	适用性高，SVM追求的是结构风险最小化。之前用于分类的学习算法都是以经验风险最小化为目标，而遵循经验风险最小化原则的结果却使得训练出来的很多分类函数能够在训练样本集上准确度达到100%，而在真实分类时分类准确度偏低。经研究发现这是因为忽略了置信风险的因素，随后引入了泛化误差界的概念即真实风险（结构风险）是由经验风险与置信风险两部分组成的。追求结构风险最小化原则使得SVM算法在建立之初就避免了结构性的缺陷。
	样本需求量小，对于同等复杂度的问题，由于SVM引入了支撑向量的概念使得支持向量机算法在计算确定分类平面时不必使用全部的样本向量而是使用具有“支撑性”的支撑向量[33]，从大量的数据中选取具备支撑性的向量对分类器进行训练，因此极大的减小了数据用量，避免了高维灾难。 
	善于处理非线性问题，SVM擅长解决样本数据线性不可分的问题，通过映射方法将低维空间中的线性不可分问题转化到高维空间中，使得样本不可分状态转为可分状态。从而转换为线性可分问题，再通过数学中凸优化的条件极值求解得出最优分类函数。同时利用松弛变量技术适当放弃孤立的错误样本点，求解出更准确的分类函数。下面阐述如何将实际工程应用中的分类问题转化为数学上求解条件极值的数学模型问题。
对于线性可分的情况
给定训练样本集 ，在样本空间中，划分超平面可以通过如下线性方程来描述
                        （4-1）
其中 为法向量决定了超平面的方向；b为位移项，决定超平面与原点间的距离，显然超平面的确立是由法向量ω与位移b确定，我们记作（ω，b），样本空间中任意点x到超平面（ω，b）的距离可写为
                        （4-2）
假设超平面（ω，b）能够将训练样本正确分类，即对于 ，若 ，则有： 若 ，则有 ，令
                    （4-3）
如图4-1所示，距离超平面最近的这几个训练样本点使得公式（4-3）的等号成立，它们被称为“支持向量”（Support Vector），两个异类支持向量到超平面的距离之和为 ， 称为“间隔”。
 
图4-1 低维线性可分
Fig. 4-1 Low dimensional linear separable
欲找到具有“最大间隔”的划分超平面，也就是要找到能满足公式（4-3）中约束的参数ω与b，使得 最大，即
                        （4-4）
 
显然，为了最大化间隔，仅需最大化 ，等价于最小化 于是公式（4-4）可以重写为
                      （4-5）
 
对公式（4-5）使用拉格朗日乘子法可得到其“对偶问题”，对公式（4-5）使用拉格朗日乘子 ，则该问题的拉格朗日函数可写为
         （4-6）
其中， 令 中的ω与b的偏导为零可得
                     （4-7）
                       （4-8）
将式（4-7）带入（4-6），即可将 中的ω与b消去，在考虑公式（4-8）的约束，就得到了式（4-5）的对偶问题即
         （4-9）
 
解出 后，求出ω与b即可得到模型（4-10）。
              （4-10）
对于线性不可分的情况
对于线性不可分的状况，通过将样本从原始空间映射到一个更高维度的特征空间，使得样本在高维特征空间中转化为线性可分问题，如图4-2所示，图中将原始的二维空间映射到一个适合的三维空间中，就能找到一个合适的划分超平面。同时，如果原始空间中的样本是有限维数，那么一定可以找到一个高维特征空间使得映射到高维空间中的映射样本变为线性可分。
 
图4-2低维线性不可分
Fig. 4-2 Low dimensional linear inseparable
令 表示x映射后的特征向量，于是在特征空间中划分超平面所对应的模型可表示为式（4-11）
                  （4-11）
其中 是模型参数，类似式（4-5），有
                    （4-12）
 
其对偶问题为
      （4-13）
 
求解（4-13）需要计算 ，这是样本 与 映射到特征空间上的内积，由于特征维数很高，对其计算的难度极大，因此使用核函数 进行计算核函数 可以使特征向量不必映射到高维特征空间中进行内积运算，而在原始样本空间中通过核函数进行运算，二者结果相同，表4-2列举了几种常用的核函数，通过核函数的引入避免了数据的高维灾难。有了这样的函数，我们不必直接计算高维甚至无穷维特征空间中的内积，于是公式（4-13）可以重写为：
       （4-14）
 
对（4-14）进行求解得
  
表4-2 几种常用的核函数
Tab.4-2 Several kinds of commonly used kernel function
核函数	表达式	参数
多项式核	 
 为多项式的次数高斯核	 
 为高斯核的带宽拉普拉斯核	 
 Sigmoid核	 
Tanh为双曲正切函数 4.1.2 AdsBoost算法
提升算法是一种可以减小监督学习中误差的机器学习算法，同时也是一种常用的统计学习算法。其中AdsBoost是提升算法中最具代表性的算法之一，被广泛应用在机器学习的分类问题当中。
在后续的研究过程中发现两者在PAC学习框架下是等价的即通过一定变化可以将多个弱可学习的分类器转化为较难直接获取的强可学习分类器，这一原理在为之后的Boosting以及AdaBoost算法的提出奠定了理论基础[34]。
提升算法从弱学习算法出发，反复学习弱概念用以获取一系列弱分类器（基本分类器），然后组合这些弱分类器构成强分类器。在获取弱分类器的过程中AdaBoost算法采取改变部分样本权值的方式来训练获取不同的弱分类器，具体做法是：AdaBoost算法会提高那些被前一轮弱分类器错误分类的样本权重值，由于权值变大会在之后的弱分类训练中受到更大的关注，以此获取可关注整体的弱分类集合。
假设给定一个二分类的数据 ，其中，每个样本点由实例与标记组成。实例 ，标记 ，X是实例空间，Y是标记集合。假设训练数据具有均匀的权值分布，初始化训练数据的权值分布为
 
对 使用具有权值分布 的训练数据集学习，得到基本分类器
 
计算 在训练数据集上的分类误差率，这里的 表示第m轮中第i个实例的权值
 
计算 的系数 
                  （4-15）
更新数据集的权值分布
       （4-16）
      （4-17）
此处 是规范化因子
             （4-18）
它使 成为一个概率分布。构建基本分类器的线性组合
                （4-19）
得到最终分类器
        （4-20）
综上，本节深入研究了当下常用于训练分类的算法，其中SVM针对于小样本问题体现出明显优势，但是SVM并不适用于解决大样本问题，并且SVM对非线性问题没有通用解决方案，针对具体问题必须谨慎选择适合的核函数进行处理，这无疑加大了应用的复杂难度。而对于AdaBoost算法在实际的运用过程中常会出现过拟合现象。因此下一节中，我们将引入深度学习方法作为分类器训练算法。
4.2 深度学习
深度学习（Deeping Learning）是基于对人工神经网络技术的研究诞生的，其学习效果更为突出。深度学习框架在一定程度上解决了传统人工神经网络算法在训练人工神经网络时常获取局部最优解而不是全局最优解问题[35]，且深度学习方法分为有监督学习与无监督学习两种策略，在无监督学习中其不依赖样本标签即可训练网络的特性使得深度学习更适合处理非线性的自然信号，因此深度学习方法被广泛应用于、语音识别、数据提取、图像检测等领域。
理论上来说，参数越多的模型复杂度越高，适应性约好，这也意味着高复杂度模型更适合解决复杂问题。然而高复杂度模型的学习低效性使训练出的模型容易陷入过拟合状态。这是制约深度学习发展的重要因素。当前多数分类、回归等学习方法，其局限性在于有限样本量与对复杂函数的计算能力有限，因此针对复杂分类问题其泛化能力受到一定制约。然而随着云计算、大数据技术的到来，云计算技术着重解决计算复杂函数的问题，大数据技术解决了小样本量问题。因此曾经被人们难以实现的含有大量待计算参数的深度学习方法被逐渐实现。
深度学习作为机器学习算法研究中的一个新技术，其目的在于构建并模拟人类大脑分析学习的神经网络[36]。1981 David Hubel与Torsten Wiesel共同发现了人类视觉系统对信息的处理机制即从最简单的形状开始，进行不断的迭代抽象[37]。从视网膜出发，首先通过边缘细胞提取边缘特征，再对边缘特征进行组合以获取视野图像的形状结构或是局部轮廓，随后在更高层形成抽象后的特征合集，最终由前额叶皮层进行分类判断[38]。人类的视觉系统对看到的场景采用的是分层处理，由底层到高层特征的表达越来越抽象且概念化。这一发现激发了人们对于神经网络系统的进一步研究。最终发现大脑的工作过程是一个对接受信号不断迭代、不断抽象概念化的过程。
有了上述介绍，可以发现，人类视觉是一种多层结构，从最浅层的基本形状开始，在深层不断的进行抽象和组合，最后判定目标信息。所以这种多层结构的视觉系统就是一种深度结构。基于上述原理，人们开始模拟神经网络对信息处理的过程，构建人工的神经网络。发展到今天，在理论研究方面已经有一些成熟的深度学习模型。常用的深度学习模型就是基于CAFFE[18]的卷积神经网络模型，比如：AlexNet、GoogleNet、VGG、ResNet等[39]。
4.2.1 深度学习的机理
当下深度学习策略分为两种，第一种是“预训练+微调”代表性深度学习策略是深度信念网络，第二种是“权值共享”代表性深度学习策略是卷积神经网络。
对于第一种即“预训练+微调”采用的是无监督层训练。无监督层训练是多隐层网络的有效训练手段。基本思想是每次训练一层隐节点记作第i层，训练时将i-1层的输出当作第i层的输入，而本第i层的输出作为第i+1层的输入，这被称为“预训练”。再对各层网络分别进行预训练完成后，最终对整个网络进行整体的“微调”训练。事实上，“预训练+微调”的做法可以视为将大量参数分组，对每组先获取本组内的最优设置，然后基于这些局部最优的结果进行“微调”操作，以获取在全局上的最后设置。这样就实现了在利用模型大量参数所提供的较大的自由度的同时，有效的节省了训练开销。
另一种训练神经网络的策略是“权值共享”，即让一组神经元使用相同的权值，以此减少训练开销。权值共享机制降低了网络的复杂性，降低了特征提取和分类过程中对数据处理的难度。神经元与输入层进行卷积时其具体的计算过程为神经元卷积模板上的权重值与对应输入像素值进行卷积计算，计算的结果记作对神经元的输入，在窗口遍历整个图像过程中其卷积模板上的权重值始终不变，保持“共享”状态，这样的处理方式减少了大量的待定参数，从而降低计算量。
实际上从另一个角度来看无论是深度信念网络还是卷积神经网络，其多隐层的堆叠，每层对上一层的输出进行处理的机制来看，可当作是通过多层处理逐渐将初始的底层特征转化为可供分析判断的抽象特征的过程，因此由简单模型转化到抽象模型后，就可作为复杂分类等学习任务的判定依据，深度学习的本质是构建具有多隐层的神经网络模型同时运用大量训练数据进行训练，从而学习到具备广泛适用性的深刻特征，以此提升分类预测的准确性。因此，深度学习的实质就是利用深度模型对特征进行深刻学习。
4.2.2 卷积神经网络
CNN中最基本的单元就是单个的神经元组织，是对人脑的神经元功能结构模拟构造的，其结构类似图4-3所示，M-P神经元模型是沿用至今的经典神经元结构[40]。在这个模型中，神经元连接到来自n个其他神经元传递来的输入信号，这些输入信号在传入前会与此神经元的权重模板进行匹配计算，具体的计算为卷积计算，计算结果会通过激励函数进行回归处理，回归后的结果通过预先设定好的阈值进行判定进而得到此神经元的输出结果a。其输出结果可作为下一层的输入提供给次级神经元，也可作为最终判断依据输入给全连接层进行分类。
 
图4-3 M-P神经元结构
Fig. 4-3 M-P Neuron structure 
在神经元内部存在两个函数，其中 是由上一层输出的结果与本层神经元通过卷积模板计算后的输入函数， 函数为激励函数，引入非线性函数作为激励函数，使得输出不再是输入的线性组合，这样可以逼近任意函数图形，适应任意状况。Sigmoid函数对 提供了非线性的组合的同时也进行了回归处理，Sigmoid函数的功能使 的结果映射到（0，1）范围内，随后通过阈值判定得出输出结果[41]。实际中可选的激活函数很多。
针对不同的任务，应该选择不同的激励函数对输入进行处理，通用性比较好的激励函数有如下三种Sigmoid函数、Tanh函数、ReLU三种函数图形如图4-4所示。其中图4-4（c）Relu效果最好，Relu会使 的部分输出为0，而使 的部分输出为输入值且大于0，这样使得网络的稀疏性加强，减少了参数的相互依存关系，缓解了过拟合问题的发生，同时Relu更容易学习优化。因为其分段线性性质，导致其前传，后传，求导都是分段线性。而传统的Sigmoid函数，由于两端饱和，在传播过程中容易丢弃信息。同样Tanh函数也存在两端易饱和的现行。因此Relu激活函数的性质相对更优良使用最广泛。
                   
（a）Sigmoid函数             （b）Tanh函数               （c）Relu函数
                    
图4-4 M-P三种常用激励函数图形
Fig. 4-4 Three kinds of commonly used excitation function graph
通过对神经元的多层级联形成了神经网络，经典的CNN如图4-5所示。图4-5是AlexNet卷积神经网络的框架图，AlexNet在2012年被提出并在当年取得了ImageNet最好成绩其官方提供的数据模型，在图4-5的框架结构中包括输入层与输出层总共9层网络结构。其中中间隐层共有7层，包含有卷积层、激励层、采样层、全连接层。
如图4-5所示，该网络除输入层外包括8个处理层，从C1到C5五层是卷积层，之后的F6到F8三层是全连接层。最后一个全连接层F8的输出被送到一个有1000个通道的Softmax层，输出一个包含1000个种类标签的分布。图4-5使用两个GPU对数据进行处理。GPU1运行图中顶部的层次部分，GPU2运行图中底部的层次部分。两个GPU之间仅在某些层之间存在通信。C2、C4、C5三层卷积网络分别与在同一GPU上的前一层特征映射图进行卷积计算并且进行滑动遍历，以此形成本层神经元生成的特征图。C3卷积层的卷积模板被连接到第二个卷积层中的所有特征映射图上，包括GPU1与GPU2两个C2卷积层。C1、C2层卷积结束后会进行响应归一化处理。C1、C2、C5卷积层映射出特征图后会经过采样层进行采样处理。
 
图4-5 卷积神经模型-AlexNet
Fig. 4-5 convolutional neural model AlexNet
F6到F8三层全连接层中的神经元均被连接到前一层中所有的神经元上。ReLU非线性应用于每个卷积层及全连接层的输出。 第一个卷积层利用96个大小为11×11×3、步长为4个像素的卷积模板对大小为224×224×3的输入图像进行卷积计算。第二个卷积层需要将第一个卷积层的输出作为自己的输入，且利用256个大小为5×5×48的卷积模板对其进行卷积。随后的C3、C4、C5三层卷积层彼此相连，没有任何介于三层之中的归一化层与采样层。C3卷积层有384个大小为3×3×256的卷积模板被连接到第二个卷积层的输出的特征图上。C4卷积层拥有384个大小为3×3×192的卷积模板，C5卷积层拥有256个大小为3×3×192的核。全连接层都各有4096个神经元。
通过图4-5的CNN可以对图像中的内容进行判断。在上述的网络中包含多个“卷积层”与“采样层”用以对输入信号进行加工，然后连接到全连接层，最终由全连接层实现与输出目标的映射。每个卷积层会产生多个特征映射图，每个特征映射图都是通过神经元的输出构成的“平面图”。通过卷积模板提取输入的一种特征，卷积模板的运算如图4-6所示，3×3卷积模板与对应输入图像区域的像素值进行卷积运算，在离散数据中即为所对应的离散值的积乘再求和，其计算公式为
                   （4-21）
根据公式（4-21）的计算方法，计算出与模板卷积后的结果，计算过程如图4-6，计算结果为-8。卷积模板上不同的权重值代表不同神经元所关注的特征类型。
 
图4-6 卷积模板
Fig. 4-6 Convolutional template
在图4-5中，每种神经元通过11×11大小的卷积模板对输入图像进行卷积运算，再通过预先设置好的步长对图像进行遍历，最终通过C_1层计算后在两个GPU上形成了共256幅特征映射图，每个特征映射图是由55×55大小的神经元阵列构成，不同的神经元产生不同的特征映射图。卷积层是CNN最关键也是最基本的组成部分，其作用是对图像特征进行不断的抽象和组合以得到更深刻的特征。每一个神经元都与前一层特征映射图的局部感受野进行卷积操作，同时由于卷积模板表示的是神经元权重。公式（4-22）给出了卷积层的定义
                （4-22）
其中 表示的是第l-1层卷积层的第i个特征图。 表示的是第l层卷积层的第j个特征图。M表示的是当前卷积层特征图的数量。 表示卷积层中可训练的权重参数和偏差。 表示非线性的函数，*号表示卷积运算。从公式（4-22）中可以看出，每一层卷积层的输入都是上一层的输出。 获取特征图之后经由 层即采样层进行采样处理。采样层也是CNN模型中重要的一层，对于降低特征向量的维数，避免维数灾难有重要的作用。所以一般情况下，采样层都会跟连接到卷积层的后面进行降维处理。采样层降维是通过图像的一种“局部不变性”原理进行处理的，即单个像素点特征可以在较大程度上替代相邻局部范围内的像素点特征。
所以在描述大的图像时，可以对不同位置的特征进行聚合统计，聚合统计后在求均值或者最大值，均值或者是最大值即为采样后的结果，全连接层一般作为参数可微的分类器存在，对于CNN，如果没有特殊说明，认为后面连接的分类器都是全连接层，当前面的卷积层和采样层等操作结束后，输出的深度特征向量，输入到全连接中，然后利用全连接计算分类得分，再利用Softmax函数计算最后的分类概率，通过最大化分类正确的概率，来更新整个模型的权值，更新模型权值的算法常用的是批量随机梯度下降。
激活层是CNN框架中重要的一层，它是由激励函数构成的，也被称为CNN的核心所在，也是和原始感知器的区别。该层是模仿脑神经源接受信号后的激活模型。可以想象，如果没有非线性的激活函数层，那么无论CNN有多少层，输出都是输入的线性组合，与没有隐藏层效果相当，即深层CNN就没有意义了，因此引入了非线性的函数作为激活函数。
4.3 利用卷积神经网络训练分类器
在CNN中，将测试函数与目标函数之间的差记作损失函数，整个神经网络在训练过程中就是在确定各个神经元之间的待定参数，随着对神经网络训练的进行，参数的值会被CNN不断修正，最终确定一组使得损失函数值最小的参数。CNN的损失函数为
                 （4-23）
              （4-24）
在公式（4-23）中 表示第i个类为正确分类， 表示计算为 正确类的得分， 表示为判断为其他类的得分，所以 表示第i类为正确类时的损失函数值，在式（4-24）中L表示平均损失函数值，最终目标是确定一组待定参数使得L即平均损失函数值最小。
4.3.1 BP反向传播算法
CNN的训练过程是逐层计算的结果，将上一层的计算结果作为下一层的输入，直到计算出最后的分类得分以及当前类的概率，这种过程称为前向传播，即前向传播的主要是依次计算各层的输出值[42]。为了方便介绍，在本小节的反向传播过程中，以单一样本为例介绍。假设分类问题共有N个类别，对于样本 ，其误差函数式（4-25）如下
     （4-25）
公式中，j表示当前被判别的类标， 表示正确的类标， 为正则项。反向传播的过程是逐层计算输出的误差项，用平方误差函数来表示最后的输出误差，如公式（4-26）
                    （4-26）
其中，E是平方误差，t是某个训练样本的目标输出，y是训练样本的真实输出，  对于每一个神经元j的输出定义为
           （4-27）
 是当前层神经元的输入，是当前神经元的权重 与前一层神经元输出 的积。激活函数 是非线性并且可微的。通用的激活函数是逻辑斯蒂函数
                     （4-28）
逻辑斯蒂的导数为
                   （4-29）
则在求解误差对权重的偏导数时，可以用两次链式法则
              （4-30）
其中：                               （4-31）
如果当前神经元所在的层连接的是输入层，则 就是输入 。另外，神经元j的输出相对于输入的导数，就是激活函数的导数，如公式（4-32）所示
       （4-32）
最后一层输出结果和总误差的偏导为
            （4-33）
用梯度下降更新权重w的过程中，一个重要的参数就是学习率 ，通过学习率来改变权重，将改变的量加到之前的权重值上，最后更新权值，反向传播的最终结果如式（4-34）所示
   （4-34）
4.3.2 利用全连接层训练分类器
卷积神经网络是一种深度学习的框架，不需要人为的介入，就能自动的得到图像特征的组合，并且对图像特征进行分类，是端到端的整体[43]。其中包括卷积核不为1×1的非全链接的卷积层，以及卷积核为1×1的全连接层，通过调研和实验，发现CNN具有很好的非线性，原因在于每个神经元上都有激活函数，而不同层的激活函数从数学公式角度来看，则是以嵌套公式的形式存在，嵌套的越多，非线性的程度就越高，理论上可以逼近无限复杂。又因为LibSVM本身存在一些参数难以确定的问题，会导致特征分类的结果达不到最优，所以本节使用截断的包含三层全连接层的卷积神经网络作为分类器，对特征进行分类，实验表明分类器换成CNN后，效果有明显的提升。利用CNN进行行人检测。
通过对现有的CNN进行学习，通过分析发现，全连接层的数量一旦过多，训练之后会出现过拟合，如果过少，则对特征组合训练的不够充分，会出现欠拟合，所以本节选择三层全连接层作为分类层，如图4-7。使用的三层全连接层F6、F7、F8神经元的数量分别为4096，4096，2，每一个神经元就是一个特征图。所有层的激活函数使用非饱和非线性函数 。对于F6层，神经元的输入是HOG与LBP级联后的融合特征向量，其中每个神经元都与特征向量的每一个值相连，即每个神经元与特征向量每个值都要进行点积的运算。F7层的连接方式与F6相同，也是每个神经元与前一层的所有特征图都相连，形成全连接。F8层是一个输出层，因为本文是对道路交通上的行人进行检测，即判断图像指定区域上是否存在行人，可以看成二分类，所以最后一层F8包含2个输出类别，该层的激活函数会给出特征向量相对于每种类别的概率，选择概率最大的那种类，判断为有或者没有行人。
 
图4-7 全连接层
Fig. 4-7 The connection layer
图4-7表示了三层全连接层对HOG-LBP特征分类的示意图。其中F6，F7是两个分类层，F8是既是全连接层也是输出层。
CNN的训练分为正向传播和反向调参2个过程[44]，本文使用该网络来处理2个类的1832张训练样本，单个输入样本为 ，其中 为n维输入向量， 为该样本标记好的真正所属类别。用L表示当前层，L层输入特征向量为 ，输出特征向量为 ，该层某个滑动卷积滤波器权值为 和偏置 。则前向传播在每层对于输入特征按公式4.31计算
 ，            （4-31）
其中 为一般为Sigmoid激励函数。在此处，对于含有1832个样本的样本集 卷积神经网络的代价函数如公式（4-32）所示
 （4.32）
其中 为权重衰减参数， 为网总层数， 为网络第L层节点数。使用批量梯度下降算法调整参数，使得整体代价函数最小化。如公式（4-33）与公式（4-34）中对每层参数 和 进行更新
              （4-33）
               （4-34）

其中，a为学习速率。上式参数关于代价函数偏导的求解需要计算每层的残差，当整个网络结构的代价误差最小时，就得到预训练好的CNN模型。
最后一层F8实质是一个分类全连接层，可以看成是一Softmax回归分类器，其类标签向量为 。对于给定的测试输入x，使用好的Softmax分类器估计出x属于每一种分类结果k的概率为 
4.3.3 实验仿真及分析
在4.3.2小节中，详细阐述了如何利用全连接层与HOG-LBP特征获取分类器，本小节中将对当下流行的分类器训练算法进行实验比较。我们使用统一的特征即HOG-LBP特征，在改变分类器算法的条件下进行实验对比。均在INRIA行人测试数据集上进行实验分析，对行人目标进行检测实验。实验数据如表4-1所示。从实验结果可以看出HOG-LBP+CNN组合在INRIA行人检测精度上表现不错，其在不同的样本数量上采用HOG-LBP+CNN组合的行人识别率总体分布在96.27%左右。
从表4-1实验结果可以看出，在同等条件下即特征均采用HOG-LBP融合特征，同时训练与测试数据集均采用INRIA行人数据集，使用三层全连接层的分类算法表现最好，在测试数据集上HOG-LBP+CNN组合精确度达到96.27%；其次为HOG-LBP+SVM组合精确度达到94.10%；HOG-LBP+Adaboost组合精确度达到91.55%。本节验证了利用三层全连接层通过对特征进行训练最终获取的分类器具有较好的分类性能。
表4-1  在INRIA数据集上的行人检测结果
Tab.4-1  Pedestrian detection results in INRIA data set


100
	
200
	
300
	
400
	
500
	
600

HOG-LBP+SVM	92.1%	92.32%	94.2%	93.89%	95.8%	96.3%
HOG-LBP+Adaboost	91.2%	89.82%	91.7%	92.2%	91.93%	92.47%
HOG-LBP+CNN	93.8%	95.9%	96.32%	96.52%	97%	98.1%
统一使用HOG-LBP特征的条件下，通过改变分类算法即分别使用SVM、CNN、AdaBoost三种分类算法，绘制出如图4-8的“负利率-漏检率”折线图，HOG-LBP+CNN算法在相同的负利率下具有更低的误检率，譬如同在负利率为15%时采用HOG-LBP+CNN算法的漏检率为0.034%；采用HOG-LBP+SVM算法的漏检率为0.05%；采用HOG-LBP+Adaboost算法的漏检率为0.074。实验结果证明采用HOG-LBP+CNN算法组合的行人检测算法能有效的降低误检率与窗口负例率。
 
图4-8 负利率-误检率
Fig. 4-8 Negative interest rates - error detection rate
4.3.4 实验结果
1. INRIA实验结果
如图4-9所示，图4-9为在INRIA测试集上的部分实验结果，对测试集中的图像进行检测，将可能出现行人的位置用红框进行圈定，结果显示HOG-LBP+CNN组合的行人检测算法在INRIA测试集上表现良好，能够准确圈定行人位置，但是对于类行人体态的柱状物体会出现误检现象，对此还需提升检测精确度。
     
图4-9 部分测试结果
Fig. 4-9 Part of the test results

2. INRIA实验结果
图4-10为交通十字路口采集的行人图像。在采集的行人图像上进行实验，结果显示本文提出的HOG-LBP+CNN行人检测算法可以对行人进行准确圈定。与Dalai检测算法相比，本文的检测方法有了一些提高，Dalai检测算法将图像中尺度较小的行人漏检掉。在误检率上，Dalai的HOG+SVM方法将骑车的人错误的看作行人，本文提出的方法却能够较好的将非行人目标与行人进行区分。
        
（a）HOG+SVM测试结果           （b）HOG-LBP+CNN测试结果
（a）HOG+SVM test Result           （b）HOG-LBP+CNN test Result
图4-10 交通图像测试结果
Fig. 4-10 The traffic image test results
4.4 本章小结
本章针对行人检测算法中训练分类部分进行深入研究分析，同时对当下流行的几种用于行人检测的分类算法进行深入学习，在学习过程中了解每种分类算法的优缺点。针对SVM分类算法不适用于解决非线性问题以及无法对大样本问题进行有效处理等问题，本章提出利用CNN的全连接层对提取到的优质特征进行训练，以获取高性能的分类器。利用神经网络进行特征分类。
通过提取HOG-LBP特征，得到高维的特征向量，接着构建1×1的卷积模板得到单个神经元的特征映射图，然后再利用三层全连接层对特征向量进行分类，通过Sorftmax层输出分类结果，实验表明，神经网络分类器能够有效的降低误检率，提高行人检测的准确率。
结  论
本文针对ITS系统中行人目标检测算法进行分析改进，针对传统检测算法在行人目标提取时，对提取行人目标提取精度偏低、判定行人位置时间过长、在复杂背景下适应较弱等问题进行改进，通过与不同特征及分类算法进行实验对比后对算法进行适当改进，并对改进后的检测算法进行实验仿真及数据对比分析，验证了本文改进算法的有效性与可行性。本文主要完成了以下几个方面的工作：
1．针对采集到的图像进行图像预处理操作，减小原有图像噪声的干扰，对毛刺、孤立点以及细小孔洞等利用膨胀、腐蚀算法进行消除，同时利用图像灰度化处理降低图像冗余信息从而减少后续计算量，最后通过图像分割技术实现图像特征信息的提取。完成了对图像序列的优化，为后续目标检测与跟踪环节的实现提供了保障。
2．在训练分类器阶段。使用截断后的部分CNN对数据进行处理，以此获得高性能的分类器，利用反向传播算法以及梯度下降算法对三层全连接层以及Softmax损失函数进行分类训练，最终获得较高性能的分类器。
3．针对当下对行人特征性状的提取，采用不同于传统的单一特征，通过对提取后的单一特征进行融合，获取融合特征。将HOG特征与LBP特征进行融合，融合后的特征对于图像的特征信息刻画的更加全面且深刻，为之后的分类器训练环节提供了优质的特征训练来源 。
本文并没有对行人检测的后处理部分进行深入研究，可以尝试对后处理部分的非极大值抑制算法进行相应的改进以获取更优良的检测效果，最终使得在对行人目标的圈定过程中出现较少的误差。
参考文献
	王欢．运动目标检测与跟踪技术研究[D].南京:南京理工大学，2009.
	杨韶瑞.车载辅助系统行人检测技术研究[J].光学工程，2012，2(2)：174-183.
	李克强，侯德藻，高锋.中国智能交通系统（ITS）与智能汽车技术发展概况[J].汽车技术，2012，25:200-201.
	ZANELLA A, BUI N, CASTELLANI A.Internet of things for smart cities[J]. IEEE Internet of Things Journal, 2014, 1(1):22-32.
	苏松志，李绍滋，陈淑媛，蔡国榕.行人检测技术综述[J].电子学报，2012，5(5)：45-46.
	周生辉.基于区域约束HOG-LBP特征的人体检测算法研究[J].控制科学与工程,2012,21(21)：21-21.
	田广.基于视觉的行人检测和跟踪技术的研究[J].计算机应用技术，2014，6(6)：65-69.
	代科学，李国辉.监控视频运动目标检测减背景技术的研究现状和展望[J].中国图像图形学报，2007，7(11)：920-927.
	钟志.基于异常行为辨识的智能监控技术研究[D].上海:上海交通大学,2008.
	李艳梅. 图像增强的相关技术及应用研究[D].成都:电子科技大学,2013.
	李亚平.VC与MATLAB的混合编程在图像处理中的应用[J].电脑知识与技术,2011,24（7）：6010-6012.
	孟绍良，王爱丽，杨明极.一种基于Curvelet变换的图像去噪方法[J].哈尔滨理工大学学报，2008，13(2)：78-81.
	许新征，丁世飞，史忠植.图像分割的新理论新方法[J].电子学报,2012,38(2A)：76-82.
	崔屹．图象处理与分析D数学形态学方法及应用[M]．北京：科学出版社，2000.
	许亦男.智能模式识别新方法及其应用[D].江苏:江南大学,2011.
	刘清，林土胜. 基于数学形态学的图像边缘检测算法[D].济南:山东师范大学,2011.
	周山. 结合二值形态学的图象边缘检测方法及其MATLAB实现[D].上海:华东师范大学,2008.
	FALAH E. Moving object segmentation for video surveillance and conferencing applications[C]. Proceedings of 2005 International Conference on Communication Technology,2005,2(2): 1263-1268..
	王亮，胡卫明，谭铁牛.人运动的视觉分析综述[J].计算机学报，2005.25(3)：225-237.
	武艳美，肖阳辉.基于特征点匹配的全局运动估计[J].计算机工程，2011，37(22)：148-155.
	翟俊海，赵文秀，王熙照.图像特征提取研究[J].河北大学学报,2013,29(1)：106-112.
	DALAL N, TRIGGS B. Histograms of oriented gradients for human detection[C]. IEEE Conference on Computer Vision & Pattern Recognition, 2005, 1(12):886-893.
	Bill T, NAVNEET D. Histograms of oriented gradients for human detection[C].2005 IEEE Computer Society Conference on Computer Vision and Pattern Recognition, 2005, 1(12):886-893.
	金辉，高文. 人脸面部混合表情识别系统[J].计算机学报，2000,23(6):602-208.
	OJAIA T, PIETIKAINEN M, Harwood D. A comparative study of texture measures with classification based on feature distributions[J]. Pattern Recognition,1996,19(3): 51-59.
	{涛，何明―，戴玉超.多级LBP直方图序列特征的人脸识别[J].中国图形学报,2009,14(2)：202-203.
	ZEILER M, TAYLOR G, FERGUS R. Adaptive deconvolutional networks for mid and high level feature learning[C].IEEE International Conference on Computer vision,2011:2018-2025.
	肖华军，赵曙光，张乐.基于HOG-LBP特征融合的头肩检测研究[J].微型机与应用,2015,22(22)：22-22. 
	韩力群.人工神经网络教程[M].北京：北京邮电大学出版社,2006.
	慕春雷,基于HOG特征的人脸识别系统研究[D].成都:电子科技大学,2013.
	LI X, SUN C, GONG D. Application of SVM and similar day method for next day load forecasting [J]. Proceedings of Advances in Natural Computation. Berlin: Springer,2011,pp. 606-613.
	WU J, YANG H. Linear regression-based efficient SVM learning for large-scale classification.[J]. IEEE Transactions on Neural Networks & Learning Systems,2015, 26(10):2357-2369.
	FELZENSZWALB P, MCALLESTER D. The generalized a architecture[J]. Artificial Intelligence Research, 2007, 16(7):2145-2152.
	[34]	施立.基于网络的三维人脸重构系统的研究[J].检测技术与自动化装置2012,27(27)：12-27. 
	[35]	HINTON G. How neural networks learn from experience[J]. Scientific American,1992,267(3):145-151.
	LI D，DONG Y. Deep Learning: Methods and Applications[J].Foundations & Trends in Signal Processing, 2013,7(3):197-205.
		吴金建，基于人类视觉系统的图像信息感知和图像质量评价[D]. 西安：西安电子科技大学，2014 
	SCHMIDHUBER J. Deep learning in neural networks: an overview[J]. Neural Networks, 2014, 61:109-117.
	何鹏程，改进的卷积神经网络模型及其应用研究[D].大连：大连理工大学，2015
	GIRSHICK R, LANDOLA F,DARRELL T, et al. Deformable part models are convolutional neural networks[J].Computer Vision & Pattern Recognition, 2014,18(33):437-446.
	刘明.支持向量机中Sigmoid核函数的研究[D].西安：西安电子科技大学，2009
	焦振.误差反向传播神经网络(BP网络)算法的启发式改进[J].计算机应用技术,2013,54（9）：1671-5330.
	SIMONYAN K, ZISERMAN A. Very deep convolutional networks for large-scale image recognition[J].Computer Vision and Pattern Recognition,2014,32(26):1569-1578.
	KRIZHEVSKY A, SUTSKEVER I, HINTON G. Imagenet classification with  deep convolutional neural networks[J].Advances in Neural Information Processing Systems, 2012, 25(2):2012.
攻读硕士学位期间发表的科研成果
	张义德,胡长雨.基于卷积神经网络的遥感图像飞机检测.光电子技术,2017,4(中文核心，已录用).
	发明型专利：房国志,张义德. 用于人脸检测的非极大值抑制方法：中国，申请号或专利号：201610493434.9.
致  谢
至此，本篇论文的纂写工作已经接近尾声，回顾硕士研究生的学业生涯，内心充满着感谢与富足。点滴的生活记忆与沉甸的收获跟友谊使我一时不知从何说起。不知不觉中毕业已然临近，我想也不必沉浸在回忆中留恋不舍，把这段经历放在心里成为自己的美好的回忆，怀揣着感恩的心，导师的教诲，家人的期盼，踏上新的征程。所谓珍惜身边人的陪伴，坦然面对前行中的困难即是对过往最好的纪念。
在纂写本文的过程中得到了很多人的支持与帮助，此片论文的纂写是在房国志教授的悉心指导下完成的。他严肃的科学态度感染并激励着我。从课题的选取到论文的最终完成，房国志老师始终给予我细心的指导和支持。在此感谢给予我谆谆教诲的房国志老师，帮助我整理数据提供实验意见的胡同学，他们是我人生中的良师益友，成为我在完成本篇论文中的灯塔，指引我前进的方向，由衷的感谢他们对我的帮助！ 
感谢实验室里朝夕相处的师兄弟是你们使我的生活变得丰富多彩！
感谢我的父母，他们默默的关心和支持是我拼搏奋斗的动力与源泉！
最后，非常感激评阅老师与答辩老师在百忙之中给予我指导与帮助，此致敬礼!祝愿您们工作顺心、身体健康！






